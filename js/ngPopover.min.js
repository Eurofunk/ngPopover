angular.module("ngPopover",[]),provider("ngPopover",function(){var t,o=!1,e=500,n=0,r=15,p=[];$(document).on("click",function(e){if(o){var n=p.some(function(t){return 0!=$(t).has(e.target).length});if(!$("#ng-popover").is(e.target)&&0==$("#ng-popover").has(e.target).length&&!n){var r=200,i=$(e.target);(i.attr("ng-popover")||i.parents(["ng-popover"]))&&(r=0),$("#ng-popover").fadeOut(r,function(){$(this).remove(),o=!1,t!=e.target&&(i.attr("ng-popover")||i.parents(["ng-popover"]))&&i.trigger("click")})}}});var i=function(t,o,p,i,a,l){var f=$(t).offset(),v=$(t).outerWidth(),c=$(t).outerHeight(),s=$("#ng-popover").outerWidth(),g=$("#ng-popover").outerHeight(),d=$(window).width();l&&($("#ng-popover").css({maxWidth:+l}),s=$("#ng-popover").outerWidth()),i&&(s=v,$("#ng-popover").css({width:s}));var h=$(window),u={top:h.scrollTop(),left:h.scrollLeft()};u.right=u.left+h.width(),u.bottom=u.top+h.height();var m;if("left"===o&&(m={left:f.left-s,top:f.top+c/2-g/2}),"right"===o&&(m={left:f.left+v,top:f.top+c/2-g/2}),"bottom"===o&&(m={left:f.left+v/2-s/2,top:f.top+c}),"top"===o&&(m={left:f.left-s/2,top:f.top-g}),"left"===o||"right"===o){var w=0;(m.top+g>u.bottom||m.top<u.top)&&(w=Math.min(m.top,m.top+g-u.bottom),m.top-=w,$("#ng-popover .arrow").css({top:w+g/2}))}if("bottom"===o||"top"===o){var b=0;m.left+s>u.right&&(b=Math.min(m.left,m.left+s-u.right),m.left-=b+r,$("#ng-popover .arrow").css({left:b+r+s/2}))}if(a){var y=$(t).find(a);anchorPosition=y.offset(),anchorWidth=y.outerWidth(),$("#ng-popover .arrow").css({left:anchorPosition.left-f.left+anchorWidth/2-1})}if(e>d&&p){var k=s-$("#ng-popover").width();$("#ng-popover").width(d-k-2*n),m.left=n,("bottom"===o||"top"===o)&&$("#ng-popover .arrow").css({left:f.left+v/2-n})}else $("#ng-popover").width(s);return m};$("body").on("keyup",function(t){27===t.keyCode&&$("#ng-popover").fadeOut(200,function(){$(this).remove(),o=!1})}),this.$get=["$rootScope","$templateCache","$compile",function(r,a,l){return{setup:function(t){e=t.smallScreenBreakpoint||500,n=t.maximizeMargin||0,p=t.overlayClasses||[]},close:function(t){r.$broadcast("ng-popover-hide",t)},open:function(e,n,p){var f=a.get(p.template||p.ngPopover);f||(f=p.template||p.ngPopover);var v=p.placement||"bottom",c=p.maximize||!1,s=p.title||"",g=p.useparentwidth||!1,d=p.anchorselector||"",h=p.maxwidth||null;p.data&&(n=n.$new(),n.rrData=p.data);var u=function(){$("body").append("<div id='ng-popover' style='display:none'><div class='arrow'></div>"+(""!=s?"<div class='title'>"+s+"</div>":"")+"<div class='content'>"+f+"</div>"+(""!=s?"<a href='' class='close-pop'>X</a>":"")+"</div>"),l($("#ng-popover").contents())(n),n.$apply();var t=i(e,v,c,g,d,h);$(".close-pop").on("click",function(){$("#ng-popover").fadeOut(200,function(){$(this).remove(),o=!1})});var r=v;"bottom"===v&&""===s&&(r="bottom-no-title"),$("#ng-popover").css({left:t.left,top:t.top}).toggleClass(r).fadeIn(100,function(){o=!0})};$(e).on("click",function(e){if(!o)if(t=e.target,r.$broadcast("ng-popover-show",n),p.init){var i=n.$eval(p.init);"object"==typeof i?i.then(function(){setTimeout(u,0)}):u()}else u()}),n.$on("ng-popover-hide",function(){$("#ng-popover").fadeOut(100,function(){$(this).remove(),o=!1})})}}}]}).directive("ngPopover",["ngPopover",function(t){return{restrict:"A",link:function(o,e,n){t.open(e,o,n)}}}]);